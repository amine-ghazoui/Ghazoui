services:
  discovery-service:
    build: ./discovery-service
    container_name: discovery-service
    ports:
      - "8761:8761"
    expose:
      - "8761"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8761/actuator/health"]
      interval: 10s
      timeout: 5s
      retries: 4

  config-service:
    build: ./config-service
    container_name: config-service
    ports:
      - "9999:9999"
    expose:   # pour pouvoir acceder au port 9999 depuis l'exterieur
      - "9999"
    environment:
      - DISCOVERY_SERVICE_URL=http://discovery-service:8761/eureka
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9999/actuator/health"]
      interval: 10s
      timeout: 5s
      retries: 4
    depends_on:
      discovery-service:
        condition: service_healthy

  keynote-service:
    build: ./keynote-service
    container_name: keynote-service
    ports:
      - "8082:8082"
    expose:
      - "8082"
    environment:
      - DISCOVERY_SERVICE_URL=http://discovery-service:8761/eureka
      - CONFIG_SERVICE_URL=http://config-service:9999
    depends_on:
      config-service:
        condition: service_healthy







#version: '3.9'
#
#services:
#  # üóÇÔ∏è Config Service
#  config-service:
#    build: ./config-service
#    container_name: config-service
#    ports:
#      - "9999:9999"
#    environment:
#      - SPRING_PROFILES_ACTIVE=docker
#    volumes:
#      - ./repo-config:/app/config-repo
#    networks:
#      - microservices-net
#
#  # üîç Discovery Service (Eureka)
#  discovery-service:
#    build: ./discovery-service
#    container_name: discovery-service
#    ports:
#      - "8761:8761"
#    depends_on:
#      - config-service
#    networks:
#      - microservices-net
#
#  # üß± Gateway Service
#  gateway-service:
#    build: ./gateway-service
#    container_name: gateway-service
#    ports:
#      - "8888:8888"
#    depends_on:
#      - discovery-service
#      - keycloak
#      - config-service
#    environment:
#      - SPRING_PROFILES_ACTIVE=docker
#    networks:
#      - microservices-net
#
#  # üéì Conference Service
#  conference-service:
#    build: ./conference-service
#    container_name: conference-service
#    ports:
#      - "8081:8081"
#    depends_on:
#      - discovery-service
#      - config-service
#      - keynote-service
#    environment:
#      - SPRING_PROFILES_ACTIVE=docker
#    networks:
#      - microservices-net
#
#  # üó£Ô∏è Keynote Service
#  keynote-service:
#    build: ./keynote-service
#    container_name: keynote-service
#    ports:
#      - "8082:8082"
#    depends_on:
#      - discovery-service
#      - config-service
#    environment:
#      - SPRING_PROFILES_ACTIVE=docker
#    networks:
#      - microservices-net
#
#  # üõ°Ô∏è Keycloak
#  keycloak:
#    image: quay.io/keycloak/keycloak:24.0.2
#    container_name: keycloak
#    command:
#      - start-dev
#    environment:
#      - KEYCLOAK_ADMIN=admin
#      - KEYCLOAK_ADMIN_PASSWORD=admin
#      - KC_HTTP_PORT=8180
#      - KC_HOSTNAME=localhost
#    ports:
#      - "8180:8180"
#    volumes:
#      - ./keycloak-data:/opt/keycloak/data
#    networks:
#      - microservices-net
#
#  # üåê Frontend Angular
#  frontend-angular:
#    build: ./frontend
#    container_name: frontend-angular
#    ports:
#      - "4200:80"
#    depends_on:
#      - gateway-service
#    networks:
#      - microservices-net
#
#networks:
#  microservices-net:
#    driver: bridge
#

